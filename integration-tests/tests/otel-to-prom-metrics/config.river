otelcol.receiver.otlp "otel_to_prom_metrics" {
  http {
    endpoint="0.0.0.0:8080"
  }

  output {
    metrics = [otelcol.exporter.prometheus.otel_to_prom_metrics.input]
  }
}

otelcol.exporter.prometheus "otel_to_prom_metrics" {
  forward_to = [prometheus.relabel.otel_to_prom_metrics.receiver]
}

prometheus.relabel "otel_to_prom_metrics" {
  forward_to = [prometheus.remote_write.otel_to_prom_metrics.receiver]

  rule {
    action        = "replace"
    source_labels = ["job"]
    replacement   = "otel_to_prom_metrics"
    target_label  = "job"
  }
}

prometheus.remote_write "otel_to_prom_metrics" {
  endpoint {
    url = "http://localhost:9009/api/v1/push"
    metadata_config {
        send_interval = "1s"
    }
    queue_config {
        max_samples_per_send = 100
    }
  }
}